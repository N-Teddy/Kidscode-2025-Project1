<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Scanner - Eventify</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://unpkg.com/html5-qrcode/minified/html5-qrcode.min.js"></script>
</head>
<body>
    <div class="scanner-container">
        <h2>QR Code Scanner</h2>
        <button id="scanButton" class="btn btn-primary">Scan with Camera 📷</button>
        <div id="reader" style="width: 300px; height: 300px;"></div>
        <div id="guestDetails" class="guest-details"></div>
        <input type="file" id="fileInput" accept="image/*" />
    </div>

    <script>
        const html5QrCode = new Html5Qrcode("reader");

        // Start scanning with camera
        document.getElementById('scanButton').addEventListener('click', function() {
            html5QrCode.start(
                { facingMode: "environment" },
                {
                    fps: 10,
                    qrbox: { width: 250, height: 250 }
                },
                (decodedText, decodedResult) => {
                    // Stop scanning after successful scan
                    html5QrCode.stop();
                    displayGuestDetails(decodedText);
                },
                (errorMessage) => {
                    // Handle scanning errors
                }
            ).catch(err => {
                console.error(err);
            });
        });

        // Function to display guest details
        function displayGuestDetails(qrCode) {
            const guestName = atob(qrCode);
            const guests = JSON.parse(localStorage.getItem('guests') || '[]');
            const guest = guests.find(g => g.name === guestName);
            const guestDetails = document.getElementById('guestDetails');

            if (guest) {
                guestDetails.innerHTML = `
                    <p>Guest Name: ${guest.name}</p>
                    <p>Table: ${guest.table}</p>
                    <p>Seat: ${guest.seat}</p>
                `;
            } else {
                guestDetails.innerHTML = '<p>Guest not found!</p>';
            }
        }

        // Handle file input for QR code scanning
        document.getElementById('fileInput').addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = new Image();
                    img.src = e.target.result;
                    img.onload = function() {
                        html5QrCode.scanImage(img).then(decodedText => {
                            displayGuestDetails(decodedText);
                        }).catch(err => {
                            console.error(err);
                        });
                    };
                };
                reader.readAsDataURL(file);
            }
        });
    </script>
</body>
</html>

<!-- <!DOCTYPE html>

<html lang="en">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>QR Scanner - Eventify</title>

    <link rel="stylesheet" href="styles.css">

    <script src="https://unpkg.com/html5-qrcode/minified/html5-qrcode.min.js"></script>

</head>

<body>

    <div class="scanner-container">

        <h2>QR Code Scanner</h2>

        <button id="scanButton" class="btn btn-primary">Scan with Camera 📷</button>

        <div id="reader" style="width: 300px; height: 300px; margin: 20px auto;"></div>

        <div id="guestDetails" class="guest-details"></div>

        <div class="file-input-section">

            <label for="fileInput" class="btn btn-secondary">📁 Upload QR Image</label>

            <input type="file" id="fileInput" accept="image/*" style="display: none;" />

        </div>

        =======

    </div>


    <script>

        const html5QrCode = new Html5Qrcode("reader");


        // Start scanning with camera

        document.getElementById('scanButton').addEventListener('click', function () {

            html5QrCode.start(

                { facingMode: "environment" },

                {

                    fps: 10,

                    qrbox: { width: 250, height: 250 }

                },

                (decodedText, decodedResult) => {

                    // Stop scanning after successful scan

                    html5QrCode.stop();

                    displayGuestDetails(decodedText);

                },

                (errorMessage) => {

                    // Handle scanning errors

                }

            ).catch(err => {

                console.error(err);

            });

        });


        // Function to display guest details

        function displayGuestDetails(qrCode) {

            const guestName = atob(qrCode);

            const guests = JSON.parse(localStorage.getItem('guests') || '[]');

            const guest = guests.find(g => g.name === guestName);

            const guestDetails = document.getElementById('guestDetails');


            if (guest) {

                guestDetails.innerHTML = `

                    <p>Guest Name: ${guest.name}</p>

                    <p>Table: ${guest.table}</p>

                    <p>Seat: ${guest.seat}</p>

                `;

            } else {

                guestDetails.innerHTML = '<p>Guest not found!</p>';

            }

        }


        // Handle file input for QR code scanning

        document.getElementById('fileInput').addEventListener('change', function (event) {

            const file = event.target.files[0];

            if (file) {

                const reader = new FileReader();

                reader.onload = function (e) {

                    const img = new Image();

                    img.src = e.target.result;

                    img.onload = function () {

                        html5QrCode.scanImage(img).then(decodedText => {

                            displayGuestDetails(decodedText);

                        }).catch(err => {

                            console.error(err);

                        });

                    };

                };

                reader.readAsDataURL(file);

            }

        });

    </script>

</body>

</html> -->