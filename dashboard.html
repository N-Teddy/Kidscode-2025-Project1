<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Eventify</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="dashboard-container">
        <!-- Header with user welcome and logout -->
        <header class="dashboard-header">
            <h1 id="welcomeMessage">What would you like to do?</h1>
            <button onclick="logout()" class="btn btn-secondary">Logout</button>
        </header>
        
        <!-- Main action cards -->
        <div class="action-cards">
            <div class="card" onclick="window.location.href='create-event-step1.html'">
                <div class="card-icon">🎉</div>
                <h3>Create an Event</h3>
                <p>Plan and organize your perfect event</p>
            </div>
            
            <div class="card" onclick="window.location.href='create-hall.html'">
                <div class="card-icon">🏛️</div>
                <h3>Create an Event Hall</h3>
                <p>Register a new venue for events</p>
            </div>
        </div>
        
        <!-- My Event Halls section -->
        <div class="halls-section">
            <h2>My Event Halls</h2>
            <div id="hallsList" class="halls-list">
                <!-- Halls will be dynamically loaded here -->
            </div>
        </div>
        
        <!-- Quick access to scanner -->
        <div class="quick-actions">
            <a href="scanner.html" class="btn btn-primary">📷 QR Scanner</a>
        </div>
    </div>

    <script>
        // Check if user is logged in when page loads
        window.onload = function() {
            const currentUser = localStorage.getItem('currentUser');
            if (!currentUser) {
                // Redirect to login if not logged in
                window.location.href = 'login.html';
                return;
            }
            
            // Update welcome message with username
            document.getElementById('welcomeMessage').textContent = 
                `What would you like to do, ${currentUser}?`;
            
            // Load user's event halls
            loadUserHalls();
        };
        
        // Function to load and display user's event halls
        function loadUserHalls() {
            const currentUser = localStorage.getItem('currentUser');
            const allHalls = JSON.parse(localStorage.getItem('eventHalls') || '[]');
            
            // Filter halls created by current user
            const userHalls = allHalls.filter(hall => hall.createdBy === currentUser);
            
            const hallsList = document.getElementById('hallsList');
            
            if (userHalls.length === 0) {
                hallsList.innerHTML = '<p class="no-halls">No event halls created yet. Create your first hall!</p>';
                return;
            }
            
            // Generate HTML for each hall
            hallsList.innerHTML = userHalls.map((hall, index) => `
                <div class="hall-item">
                    <div class="hall-info">
                        <h4>${hall.name}</h4>
                        <p class="hall-location">📍 ${hall.location}</p>
                        <p class="hall-capacity">👥 Capacity: ${hall.capacity}</p>
                        <span class="status ${hall.status.toLowerCase()}">${hall.status}</span>
                    </div>
                    <div class="hall-actions">
                        <button onclick="editHall(${index})" class="btn-icon" title="Edit">✏️</button>
                        <button onclick="deleteHall(${index})" class="btn-icon" title="Delete">🗑️</button>
                    </div>
                </div>
            `).join('');
        }
        
        // Function to edit a hall
        function editHall(index) {
            const currentUser = localStorage.getItem('currentUser');
            const allHalls = JSON.parse(localStorage.getItem('eventHalls') || '[]');
            const userHalls = allHalls.filter(hall => hall.createdBy === currentUser);
            
            // Store the hall data for editing
            localStorage.setItem('editingHall', JSON.stringify({
                ...userHalls[index],
                originalIndex: allHalls.findIndex(hall => 
                    hall.name === userHalls[index].name && 
                    hall.createdBy === currentUser
                )
            }));
            
            // Redirect to create-hall page for editing
            window.location.href = 'create-hall.html';
        }
        
        // Function to delete a hall
        function deleteHall(index) {
            if (confirm('Are you sure you want to delete this hall?')) {
                const currentUser = localStorage.getItem('currentUser');
                const allHalls = JSON.parse(localStorage.getItem('eventHalls') || '[]');
                const userHalls = allHalls.filter(hall => hall.createdBy === currentUser);
                
                // Find the hall to delete in the main array
                const hallToDelete = userHalls[index];
                const mainIndex = allHalls.findIndex(hall => 
                    hall.name === hallToDelete.name && 
                    hall.createdBy === currentUser
                );
                
                // Remove hall from main array
                allHalls.splice(mainIndex, 1);
                
                // Save updated array
                localStorage.setItem('eventHalls', JSON.stringify(allHalls));
                
                // Reload the halls list
                loadUserHalls();
            }
        }
        
        // Function to logout
        function logout() {
            localStorage.removeItem('currentUser');
            window.location.href = 'index.html';
        }
    </script>
</body>
</html>
